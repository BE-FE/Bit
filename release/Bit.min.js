!function(t,r){"function"==typeof require&&"object"==typeof module&&module&&"object"==typeof exports&&exports?module.exports=r(t):"function"==typeof define&&define.amd?define("Bit",function(){return r(t)}):t.Bit=r(t)}(window?window:this,function(){function t(t,r){return new Array((r||10)-t.toString().length+1).join("0")+t}function r(r){return null==r?new Array(9).join("0"):t((r||0).toString(2),8)}function i(r){return null==r?new Array(3).join("0"):t((r||0).toString(16),2)}var n=function(t,r){this.isLittleEndian=!!r||!1,this.length=t||8,this.originalLength=0,this.bitArray=new Array(this.length/8);for(var i=0,n=this.bitArray.length;n>i;i++)this.bitArray[i]=0;this.currentByte=0,this.currentBit=0},e=n.prototype;return e.isBitString=function(t){return"string"==typeof t&&!/[^01]/.test(t)},e.write=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&"bitArray"in t?this.writeBit.apply(this,arguments):"string"==typeof t?this.writeString.apply(this,arguments):"number"==typeof t?this.writeInt.apply(this,arguments):this},e.writeBit=function(t,r){return arguments[0]=t.toBitString(),null==r&&(arguments[1]=t.originalLength),this.writeBitString.apply(this,arguments)},e.writeString=function(t){return/^[\x00-\xff]+$/.test(t)?this.writeUTF8String.apply(this,arguments):this.writeUTF16String.apply(this,arguments)},e.writeUTF8String=function(r){for(var i="",n=0,e=r.length;e>n;n++)i+=t(r.charAt(n).charCodeAt().toString(2),8);return arguments[0]=i,this.writeBitString.apply(this,arguments)},e.writeUTF16String=function(r){for(var i,n=0,e=r.length;e>n;n++)i+=t(r.charAt(n).charCodeAt().toString(2),16);return arguments[0]=i,this.writeBitString.apply(this,arguments)},e.writeInt=function(t){return arguments[0]=t.toString(2),this.writeBitString.apply(this,arguments)},e.writeHex=function(t){var i=[];t=t.replace(/\x20+/,"");for(var n=0,e=t.length;e>n;n+=2)i.push(r(parseInt(t.charAt(n)+t.charAt(n+1),16)));return arguments[0]=i.join(""),this.writeBitString.apply(this,arguments)},e.writeBitString=function(r,i){if(null==r)return this;if(!this.isBitString(r))throw new TypeError("Type must be a BitString");if(null==i&&(i=r.length),0>=i)return this;i=Math.abs(i);var n=r;n.length>i?n=n.slice(-i):n.length<i&&(n=t(n,i));for(var e;n.length>0;)e=n.slice(this.currentBit-8),n=n.slice(0,this.currentBit-8),null==this.bitArray[this.currentByte]&&(this.bitArray[this.currentByte]=0),this.bitArray[this.currentByte]=this.bitArray[this.currentByte]+(parseInt(e,2)<<this.currentBit),this.currentByte=this.currentByte+Math.floor((this.currentBit+e.length)/8),this.currentBit=(this.currentBit+e.length)%8;return this.byteLength=this.bitArray.length,this.length=8*this.byteLength,this.originalLength=8*this.currentByte+this.currentBit,this},e.setCurrentByte=function(t){return this.currentByte=t,this},e.setCurrentBit=function(t){return this.currentBit=t,this},e.nextByte=function(){return this.setCurrentByte(this.currentByte+1),this.setCurrentBit(0),this},e.getUint8=function(t){if(this.bitArray.length<1)throw new RangeError("Unable to meet Uint8, at least 8 bits");return t=t||0,new Uint8Array(this.bitArray.slice(0,1))},e.getUint32=function(t){if(this.bitArray.length<4)throw new RangeError("Unable to meet Uint32, at least 32 bits");t=t||0;var r=this.bitArray.slice(0,4);return this.isLittleEndian&&r.reverse(),new Uint32Array},e.toBitString=function(){for(var t=[].concat(this.bitArray),i=0,n=t.length;n>i;i++)t[i]=i==n-1?t[i].toString(2):r(t[i]);return t.join("")},e.toInt32=function(){var t=[].concat(this.bitArray.slice(0,4));this.isLittleEndian&&t.reverse();for(var r=0,i=0,n=t.length;n>i;i++)r+=t[i]<<2*(n-1-i);return r},e.toBinary=function(){var t=[].concat(this.bitArray);this.isLittleEndian&&t.reverse();for(var r=0,i=t.length;i>r;r++)t[r]=String.fromCharCode(t[r]);return t.join("")},e.toDebug=function(t,i){i=i||4;this.toString();t=t||1;var n=[].concat(this.bitArray);this.isLittleEndian&&n.reverse(),n.length%i!==0&&(n=n.concat(new Array(i-n.length%i+1)));var e="\n",s="",h="",o="",a="",u="",g=!1;1&t&&(e+="  Bit "+new Array(66).join(" ")),2&t&&(e+="   U8 "),4&t&&(e+="   U16"),e+="\n",1&t&&(e+=new Array(5).join("  |-------------| ")),2&t&&(e+="      "),4&t&&(e+="      "),e+="\n";for(var c=0,l=n.length;l>c;c++){if((c+1)%i===0&&(g=!0),1&t){s+=this.currentByte===c?"[":this.currentByte+1===c?"]":" ",s+=" ";var y=r(n[c]).split("").join(" ");this.currentByte===c&&(y=y.split(""),y[14-2*this.currentBit-1]=">",y[14-2*this.currentBit+1]="<",y=y.join("")),s+=y,s+=" "}if(2&t&&(o+=r(n[c]),8===o.length)){var f=parseInt(o,2);h+=f>32&&127>f?String.fromCharCode(f):".",o=""}if(4&t&&(u+=r(n[c]),16===u.length)){var f=parseInt(u,2);a+=f>2048&&65535>f?String.fromCharCode(f):"..",u=""}g&&(1&t&&(e+=s,s=""),2&t&&(e+="  "+h,h=""),4&t&&(e+="  "+a,a=""),e+="\n"),g=!1}return e+="\n"},e.toHex=function(){for(var t=[].concat(this.bitArray),r=0,n=t.length;n>r;r++)t[r]=i(t[r]);return t.join("")},n.fromHex=function(t){return new n.writeHex(t)},e.debug=function(t){t=t||1;var r=console.log.bind(console);return r(this.toString()+"\n ----------------------------------\n"+this.toDebug(t)),this},n});